<!DOCTYPE html>
<html lang="ja">
    <head>
        <title>Game</title>
    </head>
    <body>
    <canvas id="select" width="600" height="500"></canvas>
    <script src="js/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            var canvas = $("#select").get(0);
            var ctx = canvas.getContext('2d');

            var x = 0;
            var y = 0;
			
			var answer = "2,3,4,5,8,6,7,1,9,5,7,9,1,3,4,8,6,2,1,8,6,7,9,2,5,4,3,3,6,5,9,1,7,2,8,4,8,1,2,4,6,5,3,9,7,9,4,7,3,2,8,1,5,6,6,5,3,2,4,1,9,7,8,7,9,8,6,5,3,4,2,1,4,2,1,8,7,9,6,3,5";
			var answer1 = answer.split(",");
			// 入力マス選択の行
            var BoradRowNum = 0;
            // 入力マス選択の列
            var BoradColumnNum = 0;
			
			function mass(inputNum,boxNum){
			this.correct = true;
			this.first = true;
			this.inputNum = inputNum;
			this.boxNum = boxNum;
			}
			
			var mass1 = [];
			
			
			for(var i = 0;i < 9; i++){
				for(var j = 0;j < 9; j++){
				mass1.push(new mass(10, Math.floor(i/3)*3 + Math.floor(j/3)+1));
				}
			}
			
			for(var i = 0;i < 81; i++){
				mass1[i].inputNum = answer1[i];
				var num1 = Math.floor(Math.random() * 2);
				if(num1==0){
				mass1[i].correct=false;
				mass1[i].first = false;
				}
			}
			
			//console.log(mass1[0].inputNum);

            // 入力数値選択の行
            var SelectRowNum = 0;
            // 入力数値選択の列
            var SelectColumnNum = 0;

            var inputNum = 0;

            var isClicked = false;

            var board = new Image();
            board.src = "board.png";
			var red = new Image();
            red.src = "red.png";
			var nums = new Image();
			nums.src = "numbers.png";
			var numbs = new Image();
			numbs.src = "numbers2.png";
            var image = new Image();
            image.src = "selectNum.png";
            board.onload = function () {
                ctx.drawImage(board, 75, 25);				//drawImage(image, dx, dy)
				DrawInputNum();
                /*
                ctx.drawImage(image, 0, 150, 100, 50);	//drawImage(dx, dy, dw, dh)
                ctx.drawImage(image,
                          0,   0,	//トリミング開始 x, y
                        100, 100, 	//トリミング終了 x, y
                          0,   0,	//Canvas表示座標 x, y
                        200, 200	//縮小・拡大サイズ
                );
                */
            }

            $(canvas)
		    .attr("tabindex", 0)				//onkeyup/onkeydownを使用する時に必要
		    .focus()
            .on("mousedown", function (e) {
                x = e.clientX - 128;
                y = e.clientY - 128;
				if(x < 0) x = 0;
				if(y < 0) y = 0;
				if(x > 600 - 256) x = 600 - 256;
				if(y > 500 - 256) y = 500 - 256;
				DrawInputNum();
                ctx.drawImage(image, x , y);
                isClicked = true;
				BoradColumnNum = Math.floor((e.clientX - 75) / 50);
				BoradRowNum = Math.floor((e.clientY - 25) / 50);
				console.log(BoradRowNum);
				
            })
			.on("mousemove", function (e) {
                if (!isClicked) return;
				DrawRect();
				DrawInputNum()
				ctx.drawImage(image, x, y);
                SetCulRow(e.clientX,e.clientY);
				ctx.drawImage(red, x + 22 + SelectColumnNum * 80, y  + 22 + SelectRowNum * 80);
				
            })
            .on("mouseup", function (e) {
                if (!isClicked) return;
                DrawRect();
				isClicked = false;
                SetCulRow(e.clientX,e.clientY);
				var i = BoradColumnNum + BoradRowNum * 9;
				if(mass1[i].correct==false){
                	if(mass1[i].inputNum == (SelectColumnNum+1) + 3*(SelectRowNum)){
						mass1[i].correct = true;
						CheckCul(Math.floor(i%9));
						CheckRow(Math.floor(i/9));
						CheckBox(mass1[i].boxNum);
					}
				}
				DrawInputNum();
            })
            .on("mouseout", function (e) {
                if (!isClicked) return;
                DrawRect();
				DrawInputNum();
				isClicked = false;
				
            });

            function DrawRect() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(board, 75, 25);
            }
			
			function SetCulRow(posX,posY){
			if (x - (posX - 128) > 40) SelectColumnNum = 0;
                else if (x - (posX - 128) < -40) SelectColumnNum = 2;
                else SelectColumnNum = 1;
                if (y - (posY - 128) > 40) SelectRowNum = 0;
                else if (y - (posY - 128) < -40) SelectRowNum = 2;
                else SelectRowNum = 1;
			}
			
			function CheckCul(culNum){
			var judge = true;
				for(var i=0; i<mass1.length;i++){
					if(culNum == Math.floor(i%9)){
						if(mass1[i].correct == false){
						judge = false;
						}
					}
				}
				if(judge==true){
				Bom();
				}
				
			}
			function CheckRow(rowNum){
			var judge = true;
				for(var i=0; i<mass1.length;i++){
					if(rowNum == Math.floor(i/9)){
						if(mass1[i].correct == false){
						judge = false;
						}
					}
				}
				if(judge==true){
				Bom();
				}
			}
			function CheckBox(boxNum){
			var judge = true;
				for(var i=0; i<mass1.length;i++){
					if(boxNum == mass1[i].boxNum){
						if(mass1[i].correct == false){
						judge = false;
						}
					}
				}
				if(judge==true){
				Bom();
				}
				
			}
			
			function Bom(){
			var mass2 = [];
				for(var i=0; i<mass1.length;i++){
					if(mass1[i].correct==false){
					mass2.push(mass1[i]);
					}
				}
				if(mass2.length==0)return;
				var j = Math.floor(Math.random() * mass2.length);
				mass2[j].correct = true;
			}
			
			function DrawInputNum(){
			
				for(var i=0; i<mass1.length;i++){
				
					if(mass1[i].correct==true){
					
						if(mass1[i].first == false){
							ctx.drawImage(numbs,
                          	50*(mass1[i].inputNum - 1),   0,	//トリミング開始 x, y
                        	50, 50, 	//トリミング終了 x, y
                          	(i%9) * 50 + 75,   Math.floor(i/9) * 50 + 25,	//Canvas表示座標 x, y
                        	50, 50	//縮小・拡大サイズ
                		);
						}
						if(mass1[i].first == true){
							ctx.drawImage(nums,
                          	50*(mass1[i].inputNum - 1),   0,	//トリミング開始 x, y
                        	50, 50, 	//トリミング終了 x, y
                          	(i%9) * 50 + 75,   Math.floor(i/9) * 50 + 25,	//Canvas表示座標 x, y
                        	50, 50	//縮小・拡大サイズ
                		);
						
					}
				}
			}
        }
		});
        /*
		50*(mass1[i].inputNum - 1),   0,	//トリミング開始 x, y
                        50*(mass1[i].inputNum - 1) + 50, 50, 	//トリミング終了 x, y
                          i%9 * 50,   Math.floor(i/9) * 50,	//Canvas表示座標 x, y
                        200, 200	//縮小・拡大サイズ
		*/
    </script>
    </body>
</html>